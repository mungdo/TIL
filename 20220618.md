# 20220618

 - SQLë¡œ ë§›ë³´ëŠ” ë°ì´í„° ì „ì²˜ë¦¬ ë¶„ì„
    - ìë™ì°¨ ë§¤ì¶œ ë°ì´í„°ë¥¼ ì´ìš©í•œ ë¦¬í¬íŠ¸ ì‘ì„± (1)

![https://www.mysqltutorial.org/wp-content/uploads/2009/12/MySQL-Sample-Database-Schema.png](https://www.mysqltutorial.org/wp-content/uploads/2009/12/MySQL-Sample-Database-Schema.png)

---

1. êµ¬ë§¤ ì§€í‘œ ì¶”ì¶œ

1) ë§¤ì¶œì•¡

(1) ì¼ë³„ ë§¤ì¶œì•¡ ì¡°íšŒ

<aside>
ğŸ’¡ select A.orderdate, sum(priceeach*quantityordered) sales
from classicmodels.orders A left join classicmodels.orderdetails B on A.ordernumber = B.ordernumber
group by 1 order by 1;

</aside>

(2) ì›”ë³„ ë§¤ì¶œì•¡ ì¡°íšŒ

<aside>
ğŸ’¡ select substr(A.orderdate, 1, 7) MM, sum(priceeach*quantityordered) sales
from classicmodels.orders A left join classicmodels.orderdetails B
on A.orderNumber = B.orderNumber
group by 1 order by 1;

</aside>

(3) ì—°ë„ë³„ ë§¤ì¶œì•¡ ì¡°íšŒ

<aside>
ğŸ’¡ select substr(A.orderdate, 1, 4) YYYY, sum(priceeach*quantityordered) sales
from classicmodels.orders A left join classicmodels.orderdetails B
on A.orderNumber = B.orderNumber
group by 1 order by 1;

</aside>

2) êµ¬ë§¤ì ìˆ˜, êµ¬ë§¤ ê±´ìˆ˜

(1) ì¼ë³„

<aside>
ğŸ’¡ select orderdate, count(distinct customernumber), count(distinct ordernumber)
from classicmodels.orders
group by 1 order by 1;

</aside>

(2) ì›”ë³„

<aside>
ğŸ’¡ select substr(orderdate, 1, 7), count(distinct customernumber), count(distinct ordernumber)
from classicmodels.orders
group by 1 order by 1;

</aside>

(3) ì—°ë„ë³„

<aside>
ğŸ’¡ select substr(orderdate, 1, 4), count(distinct customernumber), count(distinct ordernumber)
from classicmodels.orders
group by 1 order by 1;

</aside>

* ì¤‘ë³µ í™•ì¸

<aside>
ğŸ’¡ select count(~), count(distinct ~) 
from ~;

</aside>

3) ì—°ë„ë³„ ì¸ë‹¹ ë§¤ì¶œì•¡ AMV = ì—°ë„ë³„ ë§¤ì¶œì•¡ / êµ¬ë§¤ì ìˆ˜

<aside>
âš™ select 	substr(A.orderdate, 1, 4) YYYY,
                 count(distinct A.customernumber) purchasers,
                 sum(priceeach*quantityordered) sales,
                 sum(priceeach*quantityordered)/count(distinct A.customernumber) amv
from 	classicmodels.orders A left join classicmodels.orderdetails B
          on   A.ordernumber = B.ordernumber
group by  1 order by 1;

</aside>

4) ê±´ë‹¹ êµ¬ë§¤ ê¸ˆì•¡ ATV = ì—°ë„ë³„ ë§¤ì¶œì•¡ / êµ¬ë§¤ ê±´ìˆ˜

<aside>
âš™ select 	substr(A.orderdate, 1, 4) YYYY,
                 count(distinct A.ordernumber) purchasers,
                 sum(priceeach*quantityordered) sales,*
                 *sum(priceeach*quantityordered)/count(distinct A.ordernumber) amv
from 	classicmodels.orders A left join classicmodels.orderdetails B
           on  A.ordernumber = B.ordernumber
group by  1 order by 1;

</aside>

---

1. ê·¸ë£¹ë³„ êµ¬ë§¤ ì§€í‘œ êµ¬í•˜ê¸°

1) êµ­ê°€ë³„, ë„ì‹œë³„ ë§¤ì¶œì•¡

<aside>
ğŸ“ select 	C.country, C.city, sum(B.priceeach*B.quantityOrdered) sales
from	classicmodels.orders A left join classicmodels.orderdetails B on A.orderNumber = B.orderNumber
left join     classicmodels.customers C on A.customerNumber = C.customerNumber
group by  1,2 order by 1,2;

</aside>

2) ë¶ë¯¸, ë¹„ë¶ë¯¸ ë§¤ì¶œì•¡ ë¹„êµ

<aside>
ğŸ“ select case when country in ('USA', 'Canada') then 'North America' else 'Others' end country_gdp,
sum(priceEach*quantityOrdered) sales
from classicmodels.orders A left join classicmodels.orderdetails B
on A.orderNumber = B.orderNumber
left join classicmodels.customers C
on A.customerNumber = C.customerNumber
group by 1;

</aside>

3) ë§¤ì¶œ Top 5 êµ­ê°€ ë° ë§¤ì¶œ

(1) êµ­ê°€ë³„ ë§¤ì¶œì•¡ í…Œì´ë¸” ìƒì„± (stat)

<aside>
ğŸ“ create table classicmodels.stat as
select 	C.country, sum(B.priceeach*B.quantityOrdered) sales
from	classicmodels.orders A left join classicmodels.orderdetails B on A.orderNumber = B.orderNumber
left join     classicmodels.customers C on A.customerNumber = C.customerNumber
group by  1 order by 2 desc;

</aside>

(2) ë“±ìˆ˜ ë§¤ê¸´ í…Œì´ë¸” ìƒì„± (stat_rnk)

<aside>
ğŸ“ create table classicmodels.stat_rnk as
select country, sales, dense_rank() over(order by sales desc) rnk
from classicmodels.stat;

</aside>

(3) ìƒìœ„ 5ê°œ êµ­ê°€ ì¶”ì¶œ

<aside>
ğŸ“ select *
from classicmodels.stat_rnk
where rnk between 1 and 5;

</aside>

(4) ì„œë¸Œì¿¼ë¦¬ë¥¼ ì´ìš©í•´ì„œ í•œë²ˆì—

<aside>
ğŸ“ select *
from
(select D.country, D.sales, dense_rank() over(order by D.sales desc) rnk
from
(select 	C.country, sum(B.priceeach*B.quantityOrdered) sales
from	classicmodels.orders A left join classicmodels.orderdetails B on A.orderNumber = B.orderNumber
left join     classicmodels.customers C on A.customerNumber = C.customerNumber
group by  1 order by 2 desc) D) E
where E.rnk between 1 and 5;

</aside>